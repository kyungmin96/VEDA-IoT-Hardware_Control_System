# VEDA-IoT-Hardware_Control_System

이 프로젝트는 VEDA 미니 프로젝트로, 라즈베리 파이와 TCP 통신을 이용한 **원격 하드웨어 제어 시스템**입니다.  
클라이언트-서버 아키텍처를 통해 LED, 부저, 조도센서, 7세그먼트 디스플레이를 실시간으로 제어할 수 있습니다.

## 🚀 주요 기능

- **🔗 TCP 소켓 통신**: 클라이언트와 서버 간 실시간 명령 전송
- **💡 LED 제어**: PWM을 이용한 밝기 조절 (최대/중간/최소)
- **🔊 부저 제어**: 음악 재생 및 중지
- **🌞 조도 센서**: I2C 통신을 통한 실시간 조도 측정
- **🔢 7세그먼트**: 숫자 표시 및 카운트다운 기능
- **🔄 자동화 기능**: 조도에 따른 LED 자동 제어
- **📚 모듈화 설계**: 각 하드웨어별 독립적인 공유 라이브러리

## 시연 영상 링크(YouTube)

[[시연 영상 링크]](https://youtu.be/dQw4w9WgXcQ)


## 🏗️ 시스템 아키텍처

### 전체 구조
```
[클라이언트] ←→ TCP/IP ←→ [서버] ←→ [하드웨어 제어 모듈들]
├─ LED 제어 (PWM)
├─ 부저 제어 (음악재생)
├─ 조도센서 (I2C)
└─ 7세그먼트 (GPIO)
```

### 하드웨어 연결
- **LED**: GPIO 21번 핀 (PWM 제어)
- **부저**: GPIO 25번 핀 (SoftTone)
- **조도센서**: I2C 인터페이스 (주소: 0x48)
- **7세그먼트**: GPIO 23, 18, 15, 14번 핀

## 📁 프로젝트 구조
```
중간PJT/
├── build/ # 빌드 산출물
│ ├── server # 서버 실행파일
│ ├── client # 클라이언트 실행파일
│ └── lib*.so # 하드웨어 제어 공유 라이브러리
├── include/ # 헤더 파일
│ ├── led_ctl.h
│ ├── buz_ctl.h
│ ├── light_ctl.h
│ └── seg_ctl.h
├── src/ # 소스 코드
│ ├── server.c # 메인 서버 (데몬화, TCP 서버)
│ ├── client.c # 클라이언트 (사용자 인터페이스)
│ ├── led_ctl.c # LED PWM 제어
│ ├── buz_ctl.c # 부저 음악 재생
│ ├── light_ctl.c # I2C 조도센서
│ └── seg_ctl.c # 7세그먼트 디스플레이
├── .gitignore
└── makefile # 크로스 컴파일 빌드 스크립트
```
## 🛠️ 빌드 및 실행

### 사전 요구사항
- **라즈베리 파이 OS** (Raspberry Pi4)
- **WiringPi 라이브러리**
- **aarch64 크로스 컴파일러** (개발 PC용)

### 라즈베리 파이에서 직접 빌드
```
//WiringPi 설치
sudo apt update
sudo apt install wiringpi

//프로젝트 빌드
make all

//실행
./build/server # 서버 시작 (백그라운드 데몬)
./build/client <라즈베리파이_IP> # 클라이언트 연결
```
### 크로스 컴파일 (개발 PC)
```
크로스 컴파일러 설치
sudo apt install gcc-aarch64-linux-gnu

빌드 및 배포
make all
make deploy # 라즈베리 파이로 자동 전송
```
## 🎮 사용법

### 클라이언트 명령어
```
------MENU------

1. led_on_MAX : LED를 최대 밝기로 켭니다

2. led_on_MID : LED를 중간 밝기로 켭니다

3. led_on_MIN : LED를 최소 밝기로 켭니다

4. led_off : LED를 끕니다

5. music_on : 음악을 재생합니다

6. music_off : 음악을 중지합니다

7. light : 현재 조도 센서 값을 확인합니다

8. 7seg : 7세그먼트에 숫자를 표시합니다

9. exit : 프로그램을 종료합니다
```


### 세부 기능 설명
- **조도 기반 LED 제어**: 조도가 180 이하일 때 LED 자동 점등
- **7세그먼트 카운트다운**: 숫자 설정 시 자동으로 1초마다 감소
- **부저 콜백**: 7세그먼트가 0이 되면 부저 자동 울림

## 🔧 기술 스택

| 구분 | 기술 |
|------|------|
| **개발 언어** | C |
| **통신** | TCP 소켓 프로그래밍 |
| **하드웨어** | WiringPi 라이브러리 |
| **멀티스레딩** | pthread |
| **모듈화** | 동적 라이브러리 (dlopen/dlsym) |
| **시스템** | Linux 데몬 프로세스 |
| **빌드 시스템** | Makefile |

## 📊 성능 특징

- **비동기 처리**: 각 하드웨어별 독립적인 스레드 운영
- **실시간 응답**: TCP 소켓 기반 명령 처리
- **안정성**: 신호 처리 및 예외 상황 대응
- **확장성**: 모듈화된 라이브러리 구조로 새 장치 추가 용이

## 🔍 주요 구현 사항

### 서버 측 (server.c)
- **데몬화**: 백그라운드 프로세스로 실행
- **동적 라이브러리 로딩**: 각 하드웨어 모듈을 런타임에 로드
- **멀티 클라이언트 지원**: pthread를 이용한 동시 접속 처리
- **장치 간 상호작용**: 조도센서 → LED, 7세그먼트 → 부저

### 클라이언트 측 (client.c)  
- **사용자 친화적 메뉴**: 직관적인 명령어 인터페이스
- **실시간 피드백**: 조도센서 값 즉시 표시
- **안전한 종료**: Ctrl+C 시그널 처리

### 하드웨어 모듈
- **LED (led_ctl.c)**: PWM을 이용한 부드러운 밝기 조절
- **부저 (buz_ctl.c)**: SoftTone으로 멜로디 재생
- **조도센서 (light_ctl.c)**: I2C ADC 통신으로 정확한 측정
- **7세그먼트 (seg_ctl.c)**: GPIO 제어와 자동 카운트다운


## 예상 문제 및 해결법
```
//WiringPi 설치 확인
gpio -v

//I2C 활성화
sudo raspi-config → Interface Options → I2C → Enable

//권한 문제 해결
sudo chmod +x build/server build/client
```

